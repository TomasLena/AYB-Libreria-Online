<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goma Eva - ayb.libreria</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="styles.css">
  
  <!-- ‚úÖ Cargar jsPDF primero -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Verificar que se carg√≥ correctamente
    console.log('jsPDF cargado:', typeof window.jspdf !== 'undefined');
  </script>
  
  <!-- ‚úÖ Cargar carrito.js (manejar√° todo el carrito) -->
  <script src="carrito.js" defer></script>
  
  <style>
    .carrusel-bloque {
      margin: 3rem 0;
      padding: 0 1rem;
    }
    
    .carrusel-bloque h3 {
      font-size: 1.4rem;
      margin-bottom: 1rem;
      border-left: 4px solid #007bff;
      padding-left: 0.5rem;
      color: #333;
    }
    
    .carrusel {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      gap: 1rem;
      padding: 1rem 0;
    }
    
    /* Estilos para mostrar ambos precios */
    .precios-container {
      margin: 10px 0;
    }
    
    .precio-minorista {
      font-size: 1.1rem;
      font-weight: bold;
      color: #2c3e50;
    }
    
    .precio-mayorista {
      font-size: 1rem;
      color: #27ae60;
      margin-top: 5px;
    }
    
    .cantidad-minima {
      font-size: 0.85rem;
      color: #7f8c8d;
      display: block;
      margin-top: 3px;
    }
    
    .ahorro-mayorista {
      font-size: 0.9rem;
      color: #e74c3c;
      margin-top: 3px;
      font-weight: 500;
    }
    
    .etiqueta-precio {
      font-weight: 600;
      margin-right: 5px;
    }
    
    .info-mayorista {
      background-color: #f8f9fa;
      border-left: 4px solid #27ae60;
      padding: 8px 12px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <!-- üî∑ HEADER PRINCIPAL -->
  <header class="ayb-header-principal">
    <div class="logo">
      <img src="assets/logo que diga AyB, e.png" alt="Logo ayb.libreria">
    </div>

    <nav class="ayb-nav-principal">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="libreria.html">Librer√≠a</a></li>
        <li><a href="papeleria.html">Papeler√≠a</a></li>
        <li><a href="pizarras.html">Pizarras</a></li>
        <li><a href="escolar.html">Escolar/Universitario</a></li>
        <li><a href="artistica.html">Art√≠stica</a></li>
        <li><a href="goma-eva.html" class="active">Goma Eva</a></li>
      </ul>
    </nav>

        <div class="ayb-social-cart">
            <a href="https://www.facebook.com/share/16zETBk27d/" target="_blank" aria-label="Facebook">
            <i class="bi bi-facebook"></i>
        </a>
        <a href="https://www.instagram.com/ayb.libreria?igsh=MXR0enk3YnJsOGxxZg==" target="_blank" aria-label="Instagram">
            <i class="bi bi-instagram"></i>
        </a>
        <a href="/carrito" aria-label="Carrito">
          <i class="bi bi-cart"></i>
        </a>
        </div>
  </header>

  <!-- üîπ MEN√ö SECUNDARIO -->
  <nav class="ayb-menu-secundario">
    <ul>
      <li><a href="#goma-eva-brillo">Goma Eva Brillo</a></li>
      <li><a href="#goma-eva-lisa">Goma Eva Lisa</a></li>
      <li><a href="#abecedarios">Abecedarios</a></li>
    </ul>
  </nav>

  <!-- üéØ BANNER DE GOMA EVA -->
  <section class="banner-principal">
    <img src="assets/banner-goma-eva.jpg" alt="Goma Eva - Material para manualidades">
  </section>

  <!-- üì¶ SECCI√ìN DE SUBCATEGOR√çAS -->
  <main class="categoria-container">
    <!-- Goma Eva Brillo -->
    <section id="goma-eva-brillo" class="carrusel-bloque">
      <h3>‚ú® Goma Eva Brillo</h3>
      <div id="carrusel-goma-eva-brillo" class="carrusel">
        <!-- Los productos se cargar√°n din√°micamente -->
      </div>
    </section>

    <!-- Goma Eva Lisa -->
    <section id="goma-eva-lisa" class="carrusel-bloque">
      <h3>üìÑ Goma Eva Lisa</h3>
      <div id="carrusel-goma-eva-lisa" class="carrusel">
        <!-- Los productos se cargar√°n din√°micamente -->
      </div>
    </section>

    <!-- Abecedarios -->
    <section id="abecedarios" class="carrusel-bloque">
      <h3>üî† Abecedarios</h3>
      <div id="carrusel-abecedarios" class="carrusel">
        <!-- Los productos se cargar√°n din√°micamente -->
      </div>
    </section>
  </main>

  <!-- Modal del carrito (debe estar en cada p√°gina) -->
  <div id="carritoModal" class="carrito-modal oculto" onclick="if(event.target===this) cerrarCarrito()">
    <div class="carrito-contenido">
      <h3>üõí Tu Carrito de Compras</h3>
      <div id="carritoContenido"></div>
      <div id="carritoTotal"></div>
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button onclick="cerrarCarrito()">Seguir Comprando</button>
        <button onclick="generarPDFPedido()" style="background-color: #28a745;">
          üìÑ Descargar Pedido
        </button>
      </div>
      <button onclick="cerrarCarrito()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
    </div>
  </div>

  <!-- üìû FOOTER -->
  <footer class="footer">
    <div class="footer-content">
      <p><strong>AyB libreria</strong> ¬© 2025</p>
      <p>üìû (011) 1234-5678 | ‚úâÔ∏è contacto@ayblibreria.com</p>
      <p>üïí Lunes a viernes de 9 a 18 hs</p>
    </div>
  </footer>

  <!-- üì¶ SCRIPTS (SOLO CARGA DE PRODUCTOS) -->
  <script type="module">
    import { app } from './firebase-config.js';
    import { 
      getFirestore, collection, getDocs 
    } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';

    const db = getFirestore(app);
    
    // Subcategor√≠as de goma eva
    const SUBCATEGORIAS_GOMAEVA = [
      "goma eva brillo", "goma eva lisa", "abecedarios"
    ];

    // Cargar productos de goma eva
    async function cargarProductosGomaEva() {
      try {
        const snapshot = await getDocs(collection(db, "productos"));
        const productos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        // Filtrar y mostrar productos por subcategor√≠a
        SUBCATEGORIAS_GOMAEVA.forEach(subcategoria => {
          const idCarrusel = `carrusel-${subcategoria.replace(/\s/g, "-").toLowerCase()}`;
          const contenedor = document.getElementById(idCarrusel);
          
          if (contenedor) {
            const productosFiltrados = productos.filter(p => 
              p.categorias && p.categorias.includes(subcategoria)
            );
            
            if (productosFiltrados.length > 0) {
              contenedor.innerHTML = productosFiltrados.map(producto => `
                <div class="producto-card">
                  <img src="${producto.imagen}" alt="${producto.nombre}">
                  <div class="info-producto">
                    <h4>${producto.nombre}</h4>
                    
                    <div class="precios-container">
                      <div class="precio-minorista">
                        <span class="etiqueta-precio">üí≤ Unitario:</span>
                        <span class="precio-valor">$${producto.precio}</span>
                      </div>
                      
                      ${producto.precioMayorista ? `
                        <div class="precio-mayorista">
                          <span class="etiqueta-precio">üè™ Mayorista:</span>
                          <span class="precio-valor">$${producto.precioMayorista}</span>
                          <span class="cantidad-minima">(M√≠nimo ${producto.cantidadMinimaMayorista || 10} unidades)</span>
                        </div>
                        <div class="ahorro-mayorista">
                          ‚ö° Ahorras: $${(producto.precio - producto.precioMayorista).toFixed(2)} por unidad
                        </div>
                        <div class="info-mayorista">
                          üí° Llevando ${producto.cantidadMinimaMayorista || 10} unidades o m√°s, 
                          el precio por unidad baja a $${producto.precioMayorista}
                        </div>
                      ` : ''}
                    </div>
                    
                    ${producto.hayStock ? `
                      <input type="number" min="1" value="1" class="cantidad-producto" 
                             data-id="${producto.id}" 
                             onchange="actualizarPrecio(this, ${producto.precio}, ${producto.precioMayorista || 'null'}, ${producto.cantidadMinimaMayorista || 10})">
                      <button class="btn-carrito" 
                              data-id="${producto.id}" 
                              data-nombre="${producto.nombre}" 
                              data-precio="${producto.precio}"
                              data-precio-mayorista="${producto.precioMayorista || ''}"
                              data-cantidad-minima="${producto.cantidadMinimaMayorista || ''}">
                        Agregar al carrito
                      </button>
                    ` : `<p class="sin-stock">Sin stock</p>`}
                  </div>
                </div>
              `).join('');
            } else {
              contenedor.innerHTML = `<p class="sin-productos">Pr√≥ximamente m√°s productos en ${subcategoria}</p>`;
            }
          }
        });
        
        // Agregar event listeners a los botones del carrito
        agregarEventListenersCarrito();
        
      } catch (error) {
        console.error("Error al cargar productos:", error);
      }
    }

    // Funci√≥n para actualizar visualizaci√≥n de precio seg√∫n cantidad
    function actualizarPrecio(input, precioMinorista, precioMayorista, cantidadMinima) {
      if (!precioMayorista) return;
      
      const cantidad = parseInt(input.value);
      const contenedorPrecio = input.closest('.info-producto').querySelector('.precios-container');
      const mensajeMayorista = contenedorPrecio.querySelector('.info-mayorista');
      
      if (cantidad >= cantidadMinima && mensajeMayorista) {
        mensajeMayorista.style.display = 'block';
        mensajeMayorista.innerHTML = `‚úÖ ¬°Perfecto! Est√°s comprando al precio mayorista: $${precioMayorista} por unidad`;
        mensajeMayorista.style.backgroundColor = '#e8f5e8';
        mensajeMayorista.style.borderLeftColor = '#28a745';
      } else if (mensajeMayorista) {
        mensajeMayorista.style.display = 'block';
        mensajeMayorista.innerHTML = `üí° Llevando ${cantidadMinima} unidades o m√°s, el precio por unidad baja a $${precioMayorista}`;
        mensajeMayorista.style.backgroundColor = '#f8f9fa';
        mensajeMayorista.style.borderLeftColor = '#27ae60';
      }
    }

    // Funci√≥n para agregar event listeners a los botones del carrito
    function agregarEventListenersCarrito() {
      document.querySelectorAll('.btn-carrito').forEach(btn => {
        btn.addEventListener('click', function() {
          const id = this.dataset.id;
          const nombre = this.dataset.nombre;
          const precio = parseFloat(this.dataset.precio);
          const precioMayorista = this.dataset.precioMayorista ? parseFloat(this.dataset.precioMayorista) : null;
          const cantidadMinima = this.dataset.cantidadMinima ? parseInt(this.dataset.cantidadMinima) : null;
          
          const cantidadInput = document.querySelector(`.cantidad-producto[data-id="${id}"]`);
          const cantidad = cantidadInput ? parseInt(cantidadInput.value) : 1;
          
          // Determinar qu√© precio usar seg√∫n la cantidad
          let precioFinal = precio;
          if (precioMayorista && cantidadMinima && cantidad >= cantidadMinima) {
            precioFinal = precioMayorista;
          }
          
          // Agregar al carrito
          agregarAlCarrito({
            id,
            nombre,
            precio: precioFinal,
            cantidad,
            precioUnitarioOriginal: precio,
            precioMayorista,
            cantidadMinimaMayorista: cantidadMinima
          });
        });
      });
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', cargarProductosGomaEva);
  </script>
</body>
</html>