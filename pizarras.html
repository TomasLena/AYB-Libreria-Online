<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pizarras - ayb.libreria</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="styles.css">
  
  <!-- ✅ 1. jsPDF PRIMERO -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <!-- ✅ 2. carrito.js (autosuficiente) -->
  <script src="carrito.js" defer></script>
  
 
</head>
<body>
  <!-- 🔷 HEADER PRINCIPAL -->
  <header class="ayb-header-principal">
    <div class="logo">
      <img src="assets/logo que diga AyB, e.png" alt="Logo ayb.libreria">
    </div>

    <nav class="ayb-nav-principal">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="libreria.html">Librería</a></li>
        <li><a href="papeleria.html">Papelería</a></li>
        <li><a href="pizarras.html" class="active">Pizarras</a></li>
        <li><a href="escolar.html">Escolar</a></li>
        <li><a href="artistica.html">Artística</a></li>
        <li><a href="goma-eva.html">Goma Eva</a></li>
      </ul>
    </nav>
        <div class="ayb-social-cart">
            <a href="https://www.facebook.com/share/16zETBk27d/" target="_blank" aria-label="Facebook">
            <i class="bi bi-facebook"></i>
        </a>
        <a href="https://www.instagram.com/ayb.libreria?igsh=MXR0enk3YnJsOGxxZg==" target="_blank" aria-label="Instagram">
            <i class="bi bi-instagram"></i>
        </a>
        <a href="/carrito" aria-label="Carrito">
          <i class="bi bi-cart"></i>
        </a>
        </div>
    
  </header>

  <!-- 🔹 MENÚ SECUNDARIO -->
  <nav class="ayb-menu-secundario">
    <ul>
      <li><a href="#pizarras">Pizarras</a></li>
      <li><a href="#borradores">Borradores</a></li>
      <li><a href="#marcadores">Marcadores de Pizarra</a></li>
    </ul>
  </nav>

  <!-- 🎯 BANNER DE PIZARRAS -->
  <section class="banner-principal">
    <img src="assets/banner-pizarras.jpg" alt="Pizarras y accesorios">
  </section>

  <!-- 📦 SECCIÓN DE SUBCATEGORÍAS -->
  <main class="categoria-container">
    <!-- Pizarras -->
    <section id="pizarras" class="carrusel-bloque">
      <h3>📋 Pizarras</h3>
      <div id="carrusel-pizarras" class="carrusel">
        <!-- Los productos se cargarán dinámicamente -->
      </div>
    </section>

    <!-- Borradores -->
    <section id="borradores" class="carrusel-bloque">
      <h3>🧽 Borradores</h3>
      <div id="carrusel-borradores" class="carrusel">
        <!-- Los productos se cargarán dinámicamente -->
      </div>
    </section>

    <!-- Marcadores de Pizarra -->
    <section id="marcadores" class="carrusel-bloque">
      <h3>🖊️ Marcadores de Pizarra</h3>
      <div id="carrusel-marcadores" class="carrusel">
        <!-- Los productos se cargarán dinámicamente -->
      </div>
    </section>
  </main>

  <!-- Modal del carrito (debe estar en cada página) -->
  <div id="carritoModal" class="carrito-modal oculto" onclick="if(event.target===this) cerrarCarrito()">
    <div class="carrito-contenido">
      <h3>🛒 Tu Carrito de Compras</h3>
      <div id="carritoContenido"></div>
      <div id="carritoTotal"></div>
      <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button onclick="cerrarCarrito()">Seguir Comprando</button>
        <button onclick="generarPDFPedido()" style="background-color: #28a745;">
          📄 Descargar Pedido
        </button>
      </div>
      <button onclick="cerrarCarrito()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 20px; cursor: pointer;">×</button>
    </div>
  </div>

  <!-- 📞 FOOTER -->
  <footer class="footer">
    <div class="footer-content">
      <p><strong>AyB libreria</strong> © 2025</p>
      <p>📞 (011) 1234-5678 | ✉️ contacto@ayblibreria.com</p>
      <p>🕒 Lunes a viernes de 9 a 18 hs</p>
    </div>
  </footer>

  <!-- 📦 SCRIPTS -->
  <script type="module">
    import { app } from './firebase-config.js';
    import { 
      getFirestore, collection, getDocs 
    } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';

    const db = getFirestore(app);
    
    // Subcategorías de pizarras
    const SUBCATEGORIAS_PIZARRAS = [
      "pizarras", "borradores", "marcadores de pizarra"
    ];

    // Cargar productos de pizarras
    async function cargarProductosPizarras() {
      try {
        const snapshot = await getDocs(collection(db, "productos"));
        const productos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        
        // Filtrar y mostrar productos por subcategoría
        SUBCATEGORIAS_PIZARRAS.forEach(subcategoria => {
          const idCarrusel = `carrusel-${subcategoria.replace(/\s/g, "-").toLowerCase()}`;
          const contenedor = document.getElementById(idCarrusel);
          
          if (contenedor) {
            const productosFiltrados = productos.filter(p => 
              p.categorias && p.categorias.includes(subcategoria)
            );
            
            if (productosFiltrados.length > 0) {
              contenedor.innerHTML = productosFiltrados.map(producto => `
                <div class="producto-card">
                  <img src="${producto.imagen}" alt="${producto.nombre}">
                  <div class="info-producto">
                    <h4>${producto.nombre}</h4>
                    
                    <div class="precios-container">
                      <div class="precio-minorista">
                        <span class="etiqueta-precio">💲 Unitario:</span>
                        <span class="precio-valor">$${producto.precio}</span>
                      </div>
                      
                      ${producto.precioMayorista ? `
                        <div class="precio-mayorista">
                          <span class="etiqueta-precio">🏪 Mayorista:</span>
                          <span class="precio-valor">$${producto.precioMayorista}</span>
                          <span class="cantidad-minima">(Mínimo ${producto.cantidadMinimaMayorista || 10} unidades)</span>
                        </div>
                        <div class="ahorro-mayorista">
                          ⚡ Ahorras: $${(producto.precio - producto.precioMayorista).toFixed(2)} por unidad
                        </div>
                        <div class="info-mayorista">
                          💡 Llevando ${producto.cantidadMinimaMayorista || 10} unidades o más, 
                          el precio por unidad baja a $${producto.precioMayorista}
                        </div>
                      ` : ''}
                    </div>
                    
                    ${producto.hayStock ? `
                      <input type="number" min="1" value="1" class="cantidad-producto" 
                             data-id="${producto.id}" 
                             onchange="actualizarPrecio(this, ${producto.precio}, ${producto.precioMayorista || 'null'}, ${producto.cantidadMinimaMayorista || 10})">
                      <button class="btn-carrito" 
                              data-id="${producto.id}" 
                              data-nombre="${producto.nombre}" 
                              data-precio="${producto.precio}"
                              data-precio-mayorista="${producto.precioMayorista || ''}"
                              data-cantidad-minima="${producto.cantidadMinimaMayorista || ''}">
                        Agregar al carrito
                      </button>
                    ` : `<p class="sin-stock">Sin stock</p>`}
                  </div>
                </div>
              `).join('');
            } else {
              contenedor.innerHTML = `<p class="sin-productos">Próximamente más productos en ${subcategoria}</p>`;
            }
          }
        });
        
        // Agregar event listeners a los botones del carrito
        agregarEventListenersCarrito();
        
      } catch (error) {
        console.error("Error al cargar productos:", error);
      }
    }

    // Función para actualizar visualización de precio según cantidad
    function actualizarPrecio(input, precioMinorista, precioMayorista, cantidadMinima) {
      if (!precioMayorista) return;
      
      const cantidad = parseInt(input.value);
      const contenedorPrecio = input.closest('.info-producto').querySelector('.precios-container');
      const mensajeMayorista = contenedorPrecio.querySelector('.info-mayorista');
      
      if (cantidad >= cantidadMinima && mensajeMayorista) {
        mensajeMayorista.style.display = 'block';
        mensajeMayorista.innerHTML = `✅ ¡Perfecto! Estás comprando al precio mayorista: $${precioMayorista} por unidad`;
        mensajeMayorista.style.backgroundColor = '#e8f5e8';
        mensajeMayorista.style.borderLeftColor = '#28a745';
      } else if (mensajeMayorista) {
        mensajeMayorista.style.display = 'block';
        mensajeMayorista.innerHTML = `💡 Llevando ${cantidadMinima} unidades o más, el precio por unidad baja a $${precioMayorista}`;
        mensajeMayorista.style.backgroundColor = '#f8f9fa';
        mensajeMayorista.style.borderLeftColor = '#27ae60';
      }
    }

    // Función para agregar event listeners a los botones del carrito
    function agregarEventListenersCarrito() {
      document.querySelectorAll('.btn-carrito').forEach(btn => {
        btn.addEventListener('click', function() {
          const id = this.dataset.id;
          const nombre = this.dataset.nombre;
          const precio = parseFloat(this.dataset.precio);
          const precioMayorista = this.dataset.precioMayorista ? parseFloat(this.dataset.precioMayorista) : null;
          const cantidadMinima = this.dataset.cantidadMinima ? parseInt(this.dataset.cantidadMinima) : null;
          
          const cantidadInput = document.querySelector(`.cantidad-producto[data-id="${id}"]`);
          const cantidad = cantidadInput ? parseInt(cantidadInput.value) : 1;
          
          // Determinar qué precio usar según la cantidad
          let precioFinal = precio;
          if (precioMayorista && cantidadMinima && cantidad >= cantidadMinima) {
            precioFinal = precioMayorista;
          }
          
          // Agregar al carrito
          agregarAlCarrito({
            id,
            nombre,
            precio: precioFinal,
            cantidad,
            precioUnitarioOriginal: precio,
            precioMayorista,
            cantidadMinimaMayorista: cantidadMinima
          });
        });
      });
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', cargarProductosPizarras);
  </script>

</body>
</html>